/*! htmlparser - v0.1.0 - 2013-01-15
* ECMAScript 5 compliant version
* https://github.com/Ragnarokkr/htmlparser
* Copyright (c) 2013 ; Licensed MIT */
(function(e,t){"use strict";var r=Object.prototype,o=r.hasOwnProperty,n={};n.defaults=function(e,t){var r="object"==typeof t,n="object"==typeof e;if(n&&r){for(var i in t)o.call(t,i)&&!o.call(e,i)&&(e[i]=t[i]);return e}if(!n)throw new TypeError("It was expected a literal object for objDest argument.");if(!r)throw new TypeError("It was expected a literal object for objDefaults argument.")},n.Serializer=function(){return!this instanceof n.Serializer?new n.Serializer:(this._events={onStart:[],onTagOpen:[],onText:[],onTagClose:[],onFinish:[],onError:[]},this)},n.Serializer.prototype={addListener:function(e,t){var r="string"==typeof e,n="function"==typeof t;if(!r||!n)throw r?new TypeError("It was expected a function for the callback argument."):new TypeError("It was expected a string for the eventName argument.");if(!o.call(this._events,e))throw new ReferenceError('The required event "'+e+'" is not supported.');return this._events[e].push(t),this},removeListener:function(e,r){var n="string"==typeof e,i="function"==typeof r;if(!n)throw new TypeError("It was expected a string for the eventName argument.");if(!o.call(this._events,e))throw new ReferenceError('The required event "'+e+'" is not supported.');if(i){var s=this._events[e],a=s.indexOf(r);~a&&s.splice(a,1)}else{if(r!==t)throw new TypeError("It was expected a function for the callback argument.");this._events[e]=[]}return this},trigger:function(e,r){var n="string"==typeof e,i="object"==typeof r||r===t;if(n){if(o.call(this._events,e)){if(i){var s=this._events[e];if(s.length){r=r||{};for(var a=0;s.length>a;a++)s[a](r);return!0}return!1}throw new TypeError("It was expected a literal object for the data argument.")}throw new ReferenceError('The required event "'+e+'" is not supported.')}throw new TypeError("It was expected a string for the eventName argument.")}},n.Serializer.Events={ON_START:"onStart",ON_TAG_OPEN:"onTagOpen",ON_TAG_CLOSE:"onTagClose",ON_TEXT:"onText",ON_FINISH:"onFinish",ON_ERROR:"onError"};var i={ignoreWhitespace:!1,ignoreRootNode:!0};n.Parser=function(e,r,o){if(!this instanceof n.Parser)return new n.Parser(e,r,o);if("object"!=typeof e)throw new TypeError("It was expected an object for iterator argument.");if(this._iterator=e,!(r instanceof n.Serializer))throw new TypeError("It was expected an instance of Serializer for serializer argument");if(this._serializer=r,"object"!=typeof o&&o!==t)throw new TypeError("It was expected a literal object for options argument.");return this._options=n.defaults(o||{},i),this._treeBuffer=[],this._eventData={rootNode:this._rootNode,currentNode:null,isRoot:!0,buffer:null},this},n.Parser.prototype={_fireEvent:function(e){var t=this._treeBuffer[this._treeBuffer.length-1];return this._eventData.currentNode=t,this._eventData.isRoot=t===this._rootNode,this._serializer.trigger(e,this._eventData)},_parseDomNode:function(e){if(this._treeBuffer.push(e),e.nodeType===Node.TEXT_NODE){var t=/^\s+$/.test(e.textContent);(!this._options.ignoreWhitespace||this._options.ignoreWhitespace&&!t)&&this._fireEvent("onText")}else if(e.nodeType===Node.ELEMENT_NODE){var r=e===this._rootNode;if((!this._options.ignoreRootNode||!r||this._options.ignoreRootNode&&!r)&&this._fireEvent("onTagOpen"),e.hasChildNodes())for(var o=e.childNodes,n=0;o.length>n;n++)this._parseDomNode(o[n]);(!this._options.ignoreRootNode||!r||this._options.ignoreRootNode&&!r)&&this._fireEvent("onTagClose")}this._treeBuffer.pop()},parse:function(){try{this._fireEvent("onStart"),this._parseDomNode(this._iterator),this._fireEvent("onFinish")}catch(e){if(this._eventData.error=e,!this._fireEvent("onError"))throw e}},getResults:function(){return this._eventData.buffer}},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=n),exports.HTMLParser=n):e.HTMLParser=n})(this);